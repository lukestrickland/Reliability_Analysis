---
title: "Automation Reliability in ATC: Mixed Model Analyses"
author: "ljgs"
date: "20/09/2021"
output:
  word_document:
    reference_docx: ../assets/apa.docx
  pdf_document: default
  html_document: default
---
by Luke Strickland

```{r load_packages_and_data, echo= FALSE , results = "hide", message=FALSE, warning=FALSE}



library(tidyverse)
library(ggplot2)
library(lme4)
library(car)
library(apa)
# library(lsmeans)
library(pander)
options(digits=2)
source("R/0-analysis_functions.R")

load("img/cleandats.RData")

cleandats <- cleandats %>% mutate(C = toupper(S)==R)

colnames(cleandats)[colnames(cleandats)=="sess"] <- "Session"
colnames(cleandats)[colnames(cleandats)=="cond"] <- "Condition"
colnames(cleandats)[colnames(cleandats)=="S"] <- "Stimulus"
colnames(cleandats)[colnames(cleandats)=="failtrial"] <- "Automation"

cleandats$Session <- factor(cleandats$Session, levels=c("1", "2", "3"),
                      labels=c("One", "Two", "Three"))

cleandats$Condition <- factor(cleandats$Condition , levels=c("AUTO_L", "AUTO_H", "MANUAL"),
                      labels=c("Automation_Low", "Automation_High", "Manual"))

cleandats$Automation <- factor(cleandats$Automation, levels=c("nonf", "fail"),
                      labels=c("Automation Success", "Automation Failure"))

cleandats$Stimulus <- factor(cleandats$Stimulus, levels=c("c", "n"),
                      labels=c("Conflict", "Non-conflict"))


tmp <- 1:24
tmp <- tmp[!tmp==4]
full_balance <- c(tmp, 28) 

cleandats <- cleandats %>% filter(s %in% full_balance)

theme_set(theme_simple())

accs <-
  cleandats %>% group_by(s, Stimulus, Condition, Automation, Session) %>% 
  filter(!is.na(R)) %>% summarise(acc = mean(C)) %>%
  arrange(s) %>% arrange(Automation)

RTs <- cleandats %>% group_by(s, Stimulus, Condition, Automation, Session) %>% 
  filter(C) %>% 
  summarise(RT=mean(RT))%>% arrange(Automation)


```



```{r, echo= FALSE, include=FALSE}
library(ltm)

Auto_Trust_Scores <- read_csv("Auto_Trust_Scores.csv")

Auto_Trust_Long <- Auto_Trust_Scores %>%  pivot_longer(cols=starts_with("D"), 
               names_to = c("Session", "Condition", "Q"),
               names_pattern=
                 "D(.)_(.)_Q(.)")



trust_scores_p <- Auto_Trust_Long %>% group_by(Participant, Session, Condition) %>% 
  summarise(score=mean(value, na.rm=T))

names(trust_scores_p)[1] <- "s"

trust_cond <- trust_scores_p %>% group_by(Condition) %>% summarise(mean(score))
trust_cond_SE <- se2(trust_scores_p, facs="Condition", dvnam="score")

cronbach_d1_H <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% filter(!Participant %in% c("13")) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D1_H"))))

cronbach_d2_H <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D2_H"))))

cronbach_d3_H <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D3_H"))))


cronbach_d1_L <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% filter(!Participant %in% c("2")) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D1_L"))))

cronbach_d2_L <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D2_L"))))

cronbach_d3_L <- cronbach.alpha((Auto_Trust_Scores %>% filter(Participant %in% full_balance) %>% dplyr::select(-Participant) %>% dplyr::select(starts_with("D3_L"))))


alpha_df <- 
  as.data.frame(list("High Reliability" = c(cronbach_d1_H$alpha, cronbach_d2_H$alpha,cronbach_d3_H$alpha),
  "Low Reliability"= c(cronbach_d1_L$alpha, cronbach_d2_L$alpha,cronbach_d3_L$alpha)))

rownames(alpha_df) <- c("Session One", "Session Two", "Session Three")


pandoc.table(round(alpha_df,2))


pandoc.table(
  trust_scores_p %>% group_by(Condition) %>% summarise(cor(score[Session=="1"],
                                                         score[Session=="2"]))
)

pandoc.table(
  trust_scores_p %>% group_by(Condition) %>% summarise(cor(score[Session=="1"],
                                                         score[Session=="3"]))
)

pandoc.table(
  trust_scores_p %>% group_by(Condition) %>% summarise(cor(score[Session=="2"],
                                                         score[Session=="3"]))
)





pandoc.table(
  trust_scores_p %>% group_by(Condition) %>% summarise(cor(score[Session=="1"],
                                                         score[Session=="2"]))
)

pandoc.table(
  trust_scores_p %>% group_by(Condition) %>% summarise(cor(score[Session=="2"],
                                                         score[Session=="3"]))
)


pandoc.table(
  trust_scores_p %>% group_by(Session) %>% summarise(cor(score[Condition=="H"],
                                                         score[Condition=="L"]))
)


```

##### Trust in Automation

We analysed the effects of automation condition and session on average automation trust scores. Trust
was higher in the high-reliability condition (*M* = `r trust_cond[trust_cond$Condition=="H",2]`,
*SE* = `r trust_cond_SE["H"]`) 
than the low-reliability condition  (*M* = `r trust_cond[trust_cond$Condition=="L",2]`,
*SE* = `r trust_cond_SE["L"]`). The effect of 
session, and its interaction with condition, did not reach significance. 


```{r, echo= FALSE, include=FALSE}
specialdats <- cleandats
specialdats$subjsesh <- interaction(cleandats$s, cleandats$Session)


accs <-
  specialdats %>% group_by(s, Condition, Automation) %>%
  filter(!is.na(R)) %>% summarise(acc = mean(C)) %>%
  arrange(s) %>% arrange(Automation)

mRTs <-
  specialdats %>% group_by(s, Condition, Automation) %>%
  filter(!is.na(R)) %>% summarise(mRT = mean(RT[C])) %>%
  arrange(s) %>% arrange(Automation)

H_accs_success_effect <- accs %>% group_by(s) %>%
  summarise(accboost = acc[Condition=="Automation_High" & Automation=="Automation Success"]-
              acc[Condition=="Manual"& Automation=="Automation Success"])

H_accs_failure_effect <- accs %>% group_by(s) %>%
  summarise(accboost = acc[Condition=="Manual" & Automation=="Automation Failure"]-
              acc[Condition=="Automation_High" & Automation=="Automation Failure"])

H_mRTs_success_effect <- mRTs %>% group_by(s) %>%
  summarise(mRTboost = mRT[Condition=="Manual" & Automation=="Automation Success"] -
              mRT[Condition=="Automation_High" & Automation=="Automation Success"]
              
              )

H_mRTs_failure_effect <- mRTs %>% group_by(s) %>%
  summarise(mRTboost = mRT[Condition=="Automation_High" & Automation=="Automation Failure"] -
              mRT[Condition=="Manual" & Automation=="Automation Failure"]
              )




L_accs_success_effect <- accs %>% group_by(s) %>%
  summarise(accboost = acc[Condition=="Automation_Low" & Automation=="Automation Success"]-
              acc[Condition=="Manual"& Automation=="Automation Success"])

L_accs_failure_effect <- accs %>% group_by(s) %>%
  summarise(accboost = acc[Condition=="Manual" & Automation=="Automation Failure"]-
              acc[Condition=="Automation_Low" & Automation=="Automation Failure"])

L_mRTs_success_effect <- mRTs %>% group_by(s) %>%
  summarise(mRTboost = mRT[Condition=="Manual" & Automation=="Automation Success"] -
              mRT[Condition=="Automation_Low" & Automation=="Automation Success"]
              
              )

L_mRTs_failure_effect <- mRTs %>% group_by(s) %>%
  summarise(mRTboost = mRT[Condition=="Automation_Low" & Automation=="Automation Failure"] -
              mRT[Condition=="Manual" & Automation=="Automation Failure"]
              )




# 
# 
# H_accs_success_effect$accdrop <- H_accs_failure_effect$accboost
# H_accs_success_effect$RTcost <- H_mRTs_failure_effect$mRTboost


#
# fit_failsuccess <- lm(accdrop~accboost, data=accs_success_effect)
# fit_failRT <- lm(accdrop~RTcost, data=accs_success_effect)
# fit_successRT <- lm(accboost~RTcost, data=accs_success_effect)
# theme_set(theme_classic())
# #
# # ggplot(accs_success_effect, aes(x=accboost, y=accdrop)) + geom_point() +
# #    ylab("Failure cost") + xlab("Success improvement") +
# #   geom_abline(slope=fit_failsuccess$coefficients[2], intercept=fit_failsuccess$coefficients[1], linetype=2)
# #
# # ggplot(accs_success_effect, aes(x=RTcost, y=accboost)) + geom_point() +
# #    ylab("Success improvement") + xlab( "RT cost on failure trials") +
# #   geom_abline(slope=fit_successRT$coefficients[2], intercept=fit_successRT$coefficients[1], linetype=2)
# #
# #  ggplot(accs_success_effect, aes(x=RTcost, y=accdrop)) + geom_point() +
# #    ylab("Failure cost") + xlab( "RT cost on failure trials") +
# #   geom_abline(slope=fit_failRT $coefficients[2], intercept=fit_failRT $coefficients[1], linetype=2)
# #
#
#  users <- accs_success_effect %>%
#    filter(accboost>0.05|accdrop>0.05) %>% .$s
#
# save(users, file="img/users.RData")

H_cor_accinacc <- cor.test(H_accs_success_effect$accboost,
                           H_accs_failure_effect$accboost)

H_cor_RTinRT <- cor.test(H_mRTs_success_effect$mRTboost,
                           H_mRTs_failure_effect$mRTboost)

H_cor_accMRTsucc <- cor.test(H_accs_success_effect$accboost,
                             H_mRTs_success_effect$mRTboost)

H_cor_accdropMRTsucc <- cor.test(H_accs_failure_effect$accboost,
                             H_mRTs_success_effect$mRTboost)

H_cor_accMRTfail <- cor.test(H_accs_success_effect$accboost,
                             H_mRTs_failure_effect$mRTboost)

H_cor_accdropMRTfail <- cor.test(H_accs_failure_effect$accboost,
                             H_mRTs_failure_effect$mRTboost)




L_cor_accinacc <- cor.test(L_accs_success_effect$accboost,
                           L_accs_failure_effect$accboost)

L_cor_RTinRT <- cor.test(L_mRTs_success_effect$mRTboost,
                           L_mRTs_failure_effect$mRTboost)

L_cor_accMRTsucc <- cor.test(L_accs_success_effect$accboost,
                             L_mRTs_success_effect$mRTboost)

L_cor_accdropMRTsucc <- cor.test(L_accs_failure_effect$accboost,
                             L_mRTs_success_effect$mRTboost)

L_cor_accMRTfail <- cor.test(L_accs_success_effect$accboost,
                             L_mRTs_failure_effect$mRTboost)


L_cor_accdropMRTfail <- cor.test(L_accs_failure_effect$accboost,
                             L_mRTs_failure_effect$mRTboost)



cor.test(L_accs_success_effect$accboost,
                             H_accs_success_effect$accboost)

cor.test(L_accs_failure_effect$accboost,
                             H_accs_failure_effect$accboost)


cor.test(L_mRTs_success_effect$mRTboost,
                             H_mRTs_success_effect$mRTboost)

cor.test(L_mRTs_failure_effect$mRTboost,
                             H_mRTs_failure_effect$mRTboost)



```


##### Individual Differences
Our study focused on high trial numbers, rather than participant numbers, and so has limited power to examine individual differences. Nonetheless, we performed
exploratory analysis to examine the relationship between different effects of automation including the accuracy benefits of correct advice (automation condition accuracy - matched manual trials), the accuracy costs of incorrect advice (matched manual accuracy - automation condition accuracy), the RT benefits of correct automated advice (manual RT - automation condition RT) and the RT costs of incorrect advice (automation condition RT - matched manual trial RT).

We found that the accuracy benefits of correct decision aids were correlated with the accuracy costs 
of incorrect decision aids for both the high-reliability conditio, `r cor_apa(H_cor_accinacc, format = "markdown", print = FALSE)`, and the low-reliability automation condition, `r cor_apa(L_cor_accinacc, format = "markdown", print = FALSE)`. RT benefits of correct automated advice were not correlated with RT costs in the high-reliability condition, `r cor_apa(H_cor_RTinRT, format = "markdown", print = FALSE)`, but were in the low-reliability condition, `r cor_apa(L_cor_RTinRT, format = "markdown", print = FALSE)`. 

The extent to which correct automated advice benefited RT was correlated with accuracy benefits in the high-reliability condition, `r cor_apa(H_cor_accMRTsucc, format = "markdown", print = FALSE)`, but not the low-reliability condition, `r cor_apa(L_cor_accMRTsucc , format = "markdown", print = FALSE)`. Similarly, the benefits to RT of correct automated advice correlated with the accuracy costs of incorrect advice in the high-reliability automation condition, `r cor_apa(H_cor_accdropMRTsucc, format = "markdown", print = FALSE)`, but not the low-reliability condition, `r cor_apa(L_cor_accdropMRTsucc, format = "markdown", print = FALSE)`. Conversely, the costs to RT of incorrect automated advice correlated with costs to accuracy in the low-reliability condition, `r cor_apa(L_cor_accdropMRTfail, format = "markdown", print = FALSE)`, but not the high-reliability condition, `r cor_apa(H_cor_accdropMRTfail, format = "markdown", print = FALSE)`.




```{r, echo= FALSE, include=FALSE}
Auto_Trust_Scores <- read_csv("Auto_Trust_Scores.csv")

Auto_Trust_Long <- Auto_Trust_Scores %>%  pivot_longer(cols=starts_with("D"), 
               names_to = c("Session", "Condition", "Q"),
               names_pattern=
                 "D(.)_(.)_Q(.)")

Auto_Trust_Long %>% group_by(Condition) %>% 
  summarise(score=mean(value, na.rm=T))

p_trust_scores <- Auto_Trust_Long %>% group_by(Participant, Condition)%>% 
  summarise(score=mean(value, na.rm=T))

colnames(p_trust_scores)[1] <- "s"

p_trust_scores$s <- as.character(p_trust_scores$s)



p_scores_autoboost <- p_trust_scores %>% filter(Condition=="H") %>% 
  right_join(H_accs_success_effect, by="s")

H_success_effect_trust <- cor.test(p_scores_autoboost$score, p_scores_autoboost$accboost)



p_scores_autoboost <- p_trust_scores %>% filter(Condition=="H") %>% 
  right_join(H_accs_failure_effect, by="s")

H_failure_effect_trust <-cor.test(p_scores_autoboost$score, p_scores_autoboost$accboost)




p_scores_autoboost <- p_trust_scores %>% filter(Condition=="L") %>% 
  right_join(L_accs_success_effect, by="s")

L_success_effect_trust <- cor.test(p_scores_autoboost$score, p_scores_autoboost$accboost)


p_scores_autoboost <- p_trust_scores %>% filter(Condition=="L") %>% 
  right_join(L_accs_failure_effect, by="s")

L_failure_effect_trust <-cor.test(p_scores_autoboost$score, p_scores_autoboost$accboost)





p_scores_autoboost <- p_trust_scores %>% filter(Condition=="H") %>% 
  right_join(H_mRTs_success_effect, by="s")

H_success_effect_RT_trust <-cor.test(p_scores_autoboost$score, p_scores_autoboost$mRTboost)



p_scores_autoboost <- p_trust_scores %>% filter(Condition=="H") %>% 
  right_join(H_mRTs_failure_effect, by="s")

H_failure_effect_RT_trust <- cor.test(p_scores_autoboost$score, p_scores_autoboost$mRTboost)




p_scores_autoboost <- p_trust_scores %>% filter(Condition=="L") %>% 
  right_join(L_mRTs_success_effect, by="s")

L_success_effect_RT_trust <-cor.test(p_scores_autoboost$score, p_scores_autoboost$mRTboost)



p_scores_autoboost <- p_trust_scores %>% filter(Condition=="L") %>% 
  right_join(L_mRTs_failure_effect, by="s")

L_failure_effect_RT_trust <-cor.test(p_scores_autoboost$score, p_scores_autoboost$mRTboost)





```


We also explored correlations between the effects of automation and trust in 
automation scores in each condition. In the high-reliability condition, trust in
automation was correlated both with the benefits of correct automated decision aids, `r cor_apa(H_success_effect_trust, format = "markdown", print = FALSE)`, 
and the costs of incorrect decision aids, `r cor_apa(H_failure_effect_trust, format = "markdown", print = FALSE)`. In contrast, in the low-reliability condition it was correlated with neither the benefits
of correct decision aids,`r cor_apa(L_success_effect_trust, format = "markdown", print = FALSE)`, nor the cost of incorrect decision aids,`r cor_apa(L_failure_effect_trust, format = "markdown", print = FALSE)`. The benefits of correct automation to RT were not correlated with trust in either
the high-reliability ,`r cor_apa(H_success_effect_RT_trust, format = "markdown", print = FALSE)`, or low-reliability automation conditions,`r cor_apa(L_success_effect_RT_trust, format = "markdown", print = FALSE)`. The costs of incorrect automation to RT were not correlated with trust in the high-reliability condition, `r cor_apa(H_failure_effect_RT_trust, format = "markdown", print = FALSE)`, or in the low-reliability condition, `r cor_apa(L_failure_effect_RT_trust, format = "markdown", print = FALSE)`. 
